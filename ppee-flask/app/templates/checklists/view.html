{% extends "base.html" %}

{% block content %}
    <div class="page-header">
        <h1>
            <span id="checklist-name-display">{{ checklist.name }}</span>
            <button id="edit-name-btn" class="edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5L13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175l-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                </svg>
            </button>
        </h1>
        <a href="{{ url_for('checklists.index') }}" class="button button-secondary">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="edit-name-form" class="edit-form" style="display: none;">
        <form method="post" action="{{ url_for('checklists.edit', id=checklist.id) }}" class="inline-edit-form">
            <input type="text" name="name" id="name-input" value="{{ checklist.name }}" required>
            <input type="hidden" name="description" id="description-hidden" value="{{ checklist.description or '' }}">
            <input type="hidden" name="is_public" id="is_public_hidden" value="{{ 'on' if checklist.is_public else '' }}">
            <button type="submit" class="button button-small">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" class="button button-small button-secondary" onclick="cancelEditName()">–û—Ç–º–µ–Ω–∞</button>
        </form>
    </div>

    <div class="checklist-details">
        <div class="info-card">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–µ–∫-–ª–∏—Å—Ç–µ</h2>

            <div class="info-row">
                <div class="info-label">ID:</div>
                <div class="info-value">{{ checklist.id }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</div>
                <div class="info-value">{{ checklist.created_at|to_moscow_time|strftime('%d.%m.%Y %H:%M') }} –ú–°–ö</div>
            </div>

            {% if checklist.updated_at != checklist.created_at %}
            <div class="info-row">
                <div class="info-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</div>
                <div class="info-value">{{ checklist.updated_at|to_moscow_time|strftime('%d.%m.%Y %H:%M') }} –ú–°–ö</div>
            </div>
            {% endif %}

            <div class="info-row">
                <div class="info-label">
                    –û–ø–∏—Å–∞–Ω–∏–µ:
                    <button id="edit-description-btn" class="edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5L13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175l-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                    </button>
                </div>
                <div class="info-value">
                    <div id="description-display">{{ checklist.description or '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}</div>
                    <div id="edit-description-form" class="edit-form" style="display: none;">
                        <form method="post" action="{{ url_for('checklists.edit', id=checklist.id) }}">
                            <input type="hidden" name="name" value="{{ checklist.name }}">
                            <textarea name="description" id="description-input" rows="3">{{ checklist.description or '' }}</textarea>
                            <input type="hidden" name="is_public" id="is_public_hidden2" value="{{ 'on' if checklist.is_public else '' }}">
                            <div class="form-actions">
                                <button type="submit" class="button button-small">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button type="button" class="button button-small button-secondary" onclick="cancelEditDescription()">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            {% if current_user.is_admin() or current_user.is_prompt_engineer() or checklist.user_id == current_user.id %}
            <div class="info-row">
                <div class="info-label">
                    –û–±—â–∏–π –¥–æ—Å—Ç—É–ø:
                    {% if current_user.is_admin() or current_user.is_prompt_engineer() or checklist.user_id == current_user.id %}
                    <button id="edit-public-btn" class="edit-btn" title="–ò–∑–º–µ–Ω–∏—Ç—å –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5L13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175l-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                    </button>
                    {% endif %}
                </div>
                <div class="info-value">
                    <div id="public-display">
                        {% if checklist.is_public %}
                            <span class="public-badge">–î–∞ (–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)</span>
                        {% else %}
                            <span class="private-badge">–ù–µ—Ç (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)</span>
                        {% endif %}
                    </div>
                    {% if current_user.is_admin() or current_user.is_prompt_engineer() or checklist.user_id == current_user.id %}
                    <div id="edit-public-form" class="edit-form" style="display: none;">
                        <form method="post" action="{{ url_for('checklists.edit', id=checklist.id) }}">
                            <input type="hidden" name="name" value="{{ checklist.name }}">
                            <input type="hidden" name="description" value="{{ checklist.description or '' }}">
                            <div class="checkbox-item">
                                <input type="checkbox" 
                                       name="is_public" 
                                       id="is_public_input" 
                                       {% if checklist.is_public %}checked{% endif %}>
                                <label for="is_public_input">
                                    –û–±—â–∏–π –¥–æ—Å—Ç—É–ø (–¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç)
                                </label>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="button button-small">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button type="button" class="button button-small button-secondary" onclick="cancelEditPublic()">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="info-row">
                <div class="info-label">–û–±—â–∏–π –¥–æ—Å—Ç—É–ø:</div>
                <div class="info-value">
                    {% if checklist.is_public %}
                        <span class="public-badge">–î–∞ (–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)</span>
                    {% else %}
                        <span class="private-badge">–ù–µ—Ç (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)</span>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <div class="info-row">
                <div class="info-label">–¢–∏–ø —à–∞–±–ª–æ–Ω–∞:</div>
                <div class="info-value">
                    {% set type_names = {
                        'support': 'üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞',
                        'analysis': 'üìä –ê–Ω–∞–ª–∏–∑',
                        'qa': '‚ùì Q&A',
                        'custom': '‚öôÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π'
                    } %}
                    {{ type_names.get(checklist.template_type or 'support', 'üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞') }}
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">–ú–æ–¥–µ–ª—å LLM:</div>
                <div class="info-value">
                    <form method="post" action="{{ url_for('checklists.update_template', id=checklist.id) }}" class="inline-edit-form">
                        <select name="llm_model" id="llm_model_select">
                            {% for model in available_models %}
                                <option value="{{ model }}" {% if preferred_llm_model and model == preferred_llm_model %}selected{% endif %}>{{ model }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="button button-small">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <span class="small">(–±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–∞–∫ —Ç–µ–≥ –≤–∏–¥–∞ llm:MODEL)</span>
                    </form>
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">–†–µ–π—Ç–∏–Ω–≥:</div>
                <div class="info-value">
                    {% if checklist.rating and checklist.rating > 0 %}
                        {% set full_stars = (checklist.rating // 1)|int %}
                        {% set has_half = (checklist.rating % 1) >= 0.5 %}
                        {% for i in range(full_stars) %}‚≠ê{% endfor %}
                        {% if has_half %}‚ú®{% endif %}
                        ({{ "%.1f"|format(checklist.rating) }}/5)
                    {% else %}
                        <span class="text-muted">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</span>
                    {% endif %}
                </div>
            </div>

            <div class="info-row">
                <div class="info-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π:</div>
                <div class="info-value">{{ checklist.usage_count or 0 }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–º–æ—â–Ω–∏–∫–∞—Ö:</div>
                <div class="info-value">{{ checklist.applications.count() }}</div>
            </div>

            <div class="info-row">
                <div class="info-label">–¢–µ–≥–∏:</div>
                <div class="info-value">
                    {% if checklist.tags %}
                        {% for tag in checklist.tags %}
                            <span class="tag">{{ tag }}</span>
                        {% endfor %}
                    {% else %}
                        <span class="text-muted">–ù–µ—Ç —Ç–µ–≥–æ–≤</span>
                    {% endif %}
                </div>
            </div>

            <div class="action-buttons">
                {% if can_edit %}
                <button id="edit-template-btn" class="button">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
                {% endif %}
                <a href="{{ url_for('checklists.copy', id=checklist.id) }}" class="button">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω</a>

                {% set app_count = checklist.applications.count() %}
                {% if app_count == 0 %}
                    <form method="post"
                          action="{{ url_for('checklists.delete', id=checklist.id) }}"
                          class="inline-form"
                          id="delete-checklist-form">
                        <button type="submit" class="button button-danger">–£–¥–∞–ª–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç</button>
                    </form>
                {% else %}
                    <button class="button button-danger"
                            disabled
                            title="–ß–µ–∫-–ª–∏—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ {{ app_count }} –∑–∞—è–≤–∫–∞—Ö –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω">
                        –£–¥–∞–ª–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç
                    </button>
                {% endif %}
            </div>
        </div>

        <!-- –ë–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ -->
        <div class="prompt-preview-section">
            <h2>
                –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞
                <button id="toggle-prompt-btn" class="button button-small">–ü–æ–∫–∞–∑–∞—Ç—å</button>
            </h2>
            <div id="prompt-preview" class="prompt-preview" style="display: none;">
                <div class="prompt-text">
                    <pre>{{ checklist.get_prompt_template() }}</pre>
                </div>
                {% if checklist.response_format %}
                <div class="response-format">
                    <h3>–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:</h3>
                    <pre>{{ checklist.response_format }}</pre>
                </div>
                {% endif %}
                <div class="prompt-variables">
                    <p class="form-note">
                        <strong>–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:</strong><br>
                        <code>{query}</code> - –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>
                        <code>{context}</code> - –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                    </p>
                </div>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞ -->
        <div class="template-edit-section" id="template-edit-section" style="display: none;">
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞</h2>
            <form method="post" action="{{ url_for('checklists.update_template', id=checklist.id) }}">
                <div class="form-group">
                    <label for="edit_template_type">–¢–∏–ø —à–∞–±–ª–æ–Ω–∞</label>
                    <select id="edit_template_type" name="template_type">
                        <option value="support" {% if checklist.template_type == 'support' %}selected{% endif %}>üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞</option>
                        <option value="analysis" {% if checklist.template_type == 'analysis' %}selected{% endif %}>üìä –ê–Ω–∞–ª–∏–∑</option>
                        <option value="qa" {% if checklist.template_type == 'qa' %}selected{% endif %}>‚ùì Q&A</option>
                        <option value="custom" {% if checklist.template_type == 'custom' %}selected{% endif %}>‚öôÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="edit_tags">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                    <input type="text" 
                           id="edit_tags" 
                           name="tags" 
                           placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, FAQ"
                           value="{{ ','.join(checklist.tags) if checklist.tags else '' }}">
                    <p class="form-note small">–°–æ–≤–µ—Ç: —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–±–ª–æ–Ω–∞, –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ–≥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ <code>llm:MODEL_NAME</code>. –ù–∞–ø—Ä–∏–º–µ—Ä: <code>llm:gemma3:27b</code></p>
                </div>

                <div class="form-group">
                    <label for="edit_prompt_text">
                        –¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞
                        <button type="button" id="reset-prompt-btn" class="button button-small button-secondary">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</button>
                    </label>
                    <textarea id="edit_prompt_text" 
                              name="prompt_text" 
                              rows="15"
                              placeholder="–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ {query} –∏ {context} –≤ —Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–º–ø—Ç–∞">{{ checklist.prompt_text or checklist.get_prompt_template() }}</textarea>
                    <p class="form-note">
                        <strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:</strong><br>
                        <code>{query}</code> - –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>
                        <code>{context}</code> - –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                    </p>
                </div>

                <div class="form-group">
                    <label for="edit_response_format">–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="edit_response_format" 
                              name="response_format" 
                              rows="5"
                              placeholder="–û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞">{{ checklist.response_format or '' }}</textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <button type="button" id="cancel-edit-btn" class="button button-secondary">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" id="preview-prompt-btn" class="button button-info">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                </div>
            </form>
        </div>

        <!-- –ë–ª–æ–∫ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
        <div class="usage-examples-section">
            <h2>–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h2>
            <div class="examples-grid">
                <div class="example-card">
                    <h3>–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:</h3>
                    <div class="example-content">
                        <code>–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ?</code>
                    </div>
                </div>
                <div class="example-card">
                    <h3>–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:</h3>
                    <div class="example-content">
                        <code>[–ó–¥–µ—Å—å –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤]</code>
                    </div>
                </div>
                <div class="example-card">
                    <h3>–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:</h3>
                    <div class="example-content">
                        <code>–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ —à–∞–±–ª–æ–Ω—É</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
    <div class="page-footer">
        <a href="{{ url_for('checklists.index') }}" class="button button-secondary">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </div>

    <style>
        .badge {
            display: inline-block;
            padding: 0.25em 0.4em;
            font-size: 75%;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
            margin-right: 5px;
        }

        .badge-success {
            color: #fff;
            background-color: #28a745;
        }

        .badge-warning {
            color: #212529;
            background-color: #ffc107;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–µ–π–¥–∂–µ–π –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏ */
        .public-badge {
            color: #28a745;
            font-weight: bold;
        }
        .private-badge {
            color: #6c757d;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ */
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            margin-top: 3px;
        }
        
        .checkbox-item label {
            flex: 1;
            margin: 0;
            cursor: pointer;
        }

        .small {
            font-size: 80%;
            color: #6c757d;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è inline —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .edit-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #007bff;
            padding: 2px 6px;
            margin-left: 10px;
            border-radius: 4px;
            transition: all 0.2s;
            vertical-align: middle;
        }

        .edit-btn:hover {
            background-color: #e9ecef;
            color: #0056b3;
        }

        .page-header h1 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .edit-form {
            margin: 10px 0;
        }

        .inline-edit-form {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .inline-edit-form input[type="text"] {
            flex: 1;
            min-width: 300px;
            padding: 8px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        #description-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
        }

        .info-label {
            display: flex;
            align-items: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        button[disabled] {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è/—Å–∫—Ä—ã—Ç–∏—è */
        .edit-form {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ */
        .order-column {
            width: 80px;
            text-align: center;
        }

        .order-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .drag-handle {
            cursor: move;
            font-size: 18px;
            color: #6c757d;
            padding: 5px;
            user-select: none;
        }

        .drag-handle:hover {
            color: #007bff;
        }

        .arrow-controls {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .arrow-btn {
            background: none;
            border: 1px solid #ddd;
            cursor: pointer;
            padding: 2px 8px;
            font-size: 12px;
            line-height: 1;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .arrow-btn:hover:not([disabled]) {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .arrow-btn[disabled] {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è drag & drop */
        .parameter-row.dragging {
            opacity: 0.5;
        }

        .parameter-row.drag-over {
            border-top: 3px solid #007bff;
        }

        .sortable-active .parameter-row {
            transition: transform 0.2s;
        }

        .sort-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è LLM –∑–∞–ø—Ä–æ—Å–∞ */
        .llm-query-different {
            color: #28a745;
            font-weight: bold;
        }

        .llm-query-same {
            color: #6c757d;
            font-style: italic;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .page-footer {
            margin-top: 20px;
            margin-bottom: 30px;
            text-align: right;
            padding-right: 20px;
        }

        .page-footer .button {
            margin: 0;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–≥–æ–≤ */
        .tag {
            display: inline-block;
            padding: 0.3em 0.6em;
            margin: 0.2em;
            font-size: 0.85em;
            background-color: #e9ecef;
            color: #495057;
            border-radius: 4px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞ */
        .prompt-preview-section {
            margin-top: 30px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }

        .prompt-preview-section h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prompt-preview {
            animation: fadeIn 0.3s ease-in;
        }

        .prompt-text, .response-format {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .prompt-text pre, .response-format pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .prompt-variables {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px 15px;
            border-radius: 0 4px 4px 0;
        }

        .prompt-variables code {
            background-color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            color: #e83e8c;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ */
        .template-edit-section {
            margin-top: 30px;
            background-color: #f0f8ff;
            border-radius: 8px;
            padding: 25px;
            border: 2px solid #e0f0ff;
        }
        
        .template-edit-section h2 {
            color: #0066cc;
            margin-bottom: 20px;
        }
        
        .template-edit-section textarea {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .template-edit-section .form-note code {
            background-color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            color: #e83e8c;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è */
        .usage-examples-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .example-card {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        
        .example-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #495057;
            font-size: 1em;
        }
        
        .example-content {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        
        .button-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .button-info:hover {
            background-color: #138496;
        }
    </style>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç–∞
        const togglePromptBtn = document.getElementById('toggle-prompt-btn');
        const promptPreview = document.getElementById('prompt-preview');

        if (togglePromptBtn && promptPreview) {
            togglePromptBtn.addEventListener('click', function() {
                if (promptPreview.style.display === 'none') {
                    promptPreview.style.display = 'block';
                    this.textContent = '–°–∫—Ä—ã—Ç—å';
                } else {
                    promptPreview.style.display = 'none';
                    this.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å';
                }
            });
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
        const editTemplateBtn = document.getElementById('edit-template-btn');
        const templateEditSection = document.getElementById('template-edit-section');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const resetPromptBtn = document.getElementById('reset-prompt-btn');
        const previewPromptBtn = document.getElementById('preview-prompt-btn');
        const editPromptText = document.getElementById('edit_prompt_text');
        const editTemplateType = document.getElementById('edit_template_type');
        
        if (editTemplateBtn) {
            editTemplateBtn.addEventListener('click', function() {
                templateEditSection.style.display = 'block';
                this.style.display = 'none';
                // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
                if (promptPreview && promptPreview.style.display === 'block') {
                    promptPreview.style.display = 'none';
                    if (togglePromptBtn) togglePromptBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å';
                }
            });
        }
        
        if (cancelEditBtn) {
            cancelEditBtn.addEventListener('click', function() {
                templateEditSection.style.display = 'none';
                if (editTemplateBtn) editTemplateBtn.style.display = 'inline-block';
            });
        }
        
        // –°–±—Ä–æ—Å –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        if (resetPromptBtn && editPromptText && editTemplateType) {
            resetPromptBtn.addEventListener('click', function() {
                const templates = {
                    'support': `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–º–æ–≥–∏ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫–ª–∏–µ–Ω—Ç–∞.

–ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞: {query}

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
{context}

–ó–∞–¥–∞—á–∞: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã
[–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ —Å—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã]

## –†–µ—à–µ–Ω–∏–µ
[–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å]

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
[–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ —É—Ç–æ—á–Ω–∏—Ç—å –∏–ª–∏ –µ—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]`,
                    
                    'analysis': `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –æ—Ç–≤–µ—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å.

–ó–∞–ø—Ä–æ—Å: {query}

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
{context}

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –≤—ã–≤–æ–¥–∞–º–∏.`,
                    
                    'qa': `–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–í–æ–ø—Ä–æ—Å: {query}

–î–æ—Å—Ç—É–ø–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
{context}

–ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º —á–µ—Å—Ç–Ω–æ.`,
                    
                    'custom': `–ó–∞–ø—Ä–æ—Å: {query}

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
{context}

–û—Ç–≤–µ—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.`
                };
                
                const selectedType = editTemplateType.value;
                editPromptText.value = templates[selectedType] || templates['custom'];
            });
        }
        
        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–º–ø—Ç–∞
        if (previewPromptBtn) {
            previewPromptBtn.addEventListener('click', function() {
                const promptText = editPromptText.value;
                const responseFormat = document.getElementById('edit_response_format').value;
                
                // –°–æ–∑–¥–∞—ë–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                `;
                
                const content = document.createElement('div');
                content.style.cssText = `
                    background: white;
                    padding: 30px;
                    border-radius: 8px;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                `;
                
                content.innerHTML = `
                    <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–º–ø—Ç–∞</h2>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0;">
                        <pre style="white-space: pre-wrap; font-family: 'Courier New', monospace;">${promptText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                    </div>
                    ${responseFormat ? `
                    <h3>–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:</h3>
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 4px;">
                        <pre style="white-space: pre-wrap; font-family: 'Courier New', monospace;">${responseFormat.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                    </div>
                    ` : ''}
                    <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
                `;
                
                modal.appendChild(content);
                document.body.appendChild(modal);
                
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            });
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
        const editNameBtn = document.getElementById('edit-name-btn');
        const nameDisplay = document.getElementById('checklist-name-display');
        const editNameForm = document.getElementById('edit-name-form');
        const nameInput = document.getElementById('name-input');

        editNameBtn.addEventListener('click', function() {
            nameDisplay.style.display = 'none';
            editNameBtn.style.display = 'none';
            editNameForm.style.display = 'block';
            nameInput.focus();
            nameInput.select();
        });

        function cancelEditName() {
            nameDisplay.style.display = 'inline';
            editNameBtn.style.display = 'inline';
            editNameForm.style.display = 'none';
            nameInput.value = {{ checklist.name|tojson|safe }};
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
        const editDescriptionBtn = document.getElementById('edit-description-btn');
        const descriptionDisplay = document.getElementById('description-display');
        const editDescriptionForm = document.getElementById('edit-description-form');
        const descriptionInput = document.getElementById('description-input');
        const descriptionHidden = document.getElementById('description-hidden');

        editDescriptionBtn.addEventListener('click', function() {
            descriptionDisplay.style.display = 'none';
            editDescriptionBtn.style.display = 'none';
            editDescriptionForm.style.display = 'block';
            descriptionInput.focus();
        });

        function cancelEditDescription() {
            descriptionDisplay.style.display = 'block';
            editDescriptionBtn.style.display = 'inline';
            editDescriptionForm.style.display = 'none';
            descriptionInput.value = {{ (checklist.description or '')|tojson|safe }};
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
        descriptionInput.addEventListener('input', function() {
            descriptionHidden.value = descriptionInput.value;
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Escape –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (editNameForm.style.display === 'block') {
                    cancelEditName();
                }
                if (editDescriptionForm.style.display === 'block') {
                    cancelEditDescription();
                }
            }
        });

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –Ω–∞–∑–≤–∞–Ω–∏—è
        document.querySelector('.inline-edit-form').addEventListener('submit', function(event) {
            const newName = nameInput.value.trim();
            if (!newName) {
                event.preventDefault();
                alert('–ù–∞–∑–≤–∞–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
                nameInput.focus();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–æ—Ä–º—ã —É–¥–∞–ª–µ–Ω–∏—è —á–µ–∫-–ª–∏—Å—Ç–∞
        const deleteForm = document.getElementById('delete-checklist-form');
        if (deleteForm) {
            deleteForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const confirmMessage = '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω "' + {{ checklist.name|tojson|safe }} + '"?\n\n' +
                                     '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.';

                if (confirm(confirmMessage)) {
                    this.submit();
                }
            });
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏
        const editPublicBtn = document.getElementById('edit-public-btn');
        const publicDisplay = document.getElementById('public-display');
        const editPublicForm = document.getElementById('edit-public-form');
        const publicInput = document.getElementById('is_public_input');
        const publicHidden = document.getElementById('is_public_hidden');
        const publicHidden2 = document.getElementById('is_public_hidden2');
        
        if (editPublicBtn && publicDisplay && editPublicForm) {
            editPublicBtn.addEventListener('click', function() {
                publicDisplay.style.display = 'none';
                editPublicBtn.style.display = 'none';
                editPublicForm.style.display = 'block';
                publicInput.focus();
            });
        }
        
        function cancelEditPublic() {
            if (publicDisplay && editPublicBtn && editPublicForm) {
                publicDisplay.style.display = 'block';
                editPublicBtn.style.display = 'inline';
                editPublicForm.style.display = 'none';
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                publicInput.checked = {{ 'true' if checklist.is_public else 'false' }};
            }
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
        if (publicInput && publicHidden && publicHidden2) {
            publicInput.addEventListener('change', function() {
                const value = this.checked ? 'on' : '';
                publicHidden.value = value;
                publicHidden2.value = value;
            });
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É Escape –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (editNameForm.style.display === 'block') {
                    cancelEditName();
                }
                if (editDescriptionForm && editDescriptionForm.style.display === 'block') {
                    cancelEditDescription();
                }
                if (editPublicForm && editPublicForm.style.display === 'block') {
                    cancelEditPublic();
                }
            }
        });
    </script>
{% endblock %}